---
layout:     post
title:      arm的基本常识
subtitle:   arm
date:       2019-04-07
author:     BY 孟超
header-img: img/arm.jpg
catalog: 	 true
tags:
    - arm
---

# 1、ARM公司发展史

①ARM前身为艾康电脑，于1978年在英国剑桥成立

②1980年苹果与艾康合作，研究ARM

③1985年研究出ARM1（全球第一款商用RISC架构CPU

④1990年从艾康电脑中分离出Advanced RICS Machines（ARM），ARM公司正式成立。

# 2、ARM公司的商业模式

ARM公司不生产芯片，他们只设计芯片，出售版权

# 3、ARM的各种版本号



内核版本号		SOC版本号			芯片型号

ARMv4 			ARM7				s3c44B0

​				     ARM9				s3c2440  s3c2410

ARMv5			ARM9+xscale

ARMv6			ARM11				s3c6410

​				    cortex-M(单片机)		STM32	

ARMv7		        cortex-A(嵌入式)		cortex-A8（s5pv210）cortex-A9（exynos4412）

​				    cortex-R(工业实时性)



# 4、SOC与CPU的区别

SOC=system on chip(片上系统)

ARM出售的内核就是CPU，SOC中包含外设，集成度高



# 5、交叉编译

何为交叉编译：A机编写程序源代码，编译后得到可执行城西，发布给B机运行。

就像我们是在linux下编译程序，烧录到s5pv210，这就是交叉编译。

交叉编译的特点：必须使用专用的交叉编译工具链（arm-linux-gcc），不能本地调试，通过JTAG等下载工具下载程序到目标嵌入式开发板中，才可以。



# 6、嵌入式系统特点

① 专用，软硬件可裁剪

②低功耗、高可靠性和高稳定性

③代码可固化

④实时性

⑤软件代码短小精悍

⑥专业开发人员

⑦专业开发工具及开发环境

⑧弱交互性



# 7、可编程器件的原理

①CPU在固定的时钟频路控制下进行有节奏的运行

②CPU通过总线读取外部的可存储设备中的二进制指令集然后解码执行

③所谓的指令集是CPU设计的时候，也就是ARM设计的时候已经确定下来了。

④我们平时的数字电路里边的芯片只有一对门电路，是不可编程器件



# 8、RISC 和CISC架构

Intel采用的就是CISC架构的CPU，可以用最少的指令完成任务，编译器也比较好设计，但是工艺相当复杂，功耗高，比较难做。

ARM采用的就是RISC架构，功耗低，芯片好做，精简指令集，指令少



# 9、统一编址、独立编址、哈佛结构、冯诺依曼结构

IO：input output 如uart  LCD LED等外设都是IO，内存，CPU通过地址总线来访问，

统一编址：内存和IO都是通过总线地址来让CPU访问。

独立编址：IO用专用的指令集去访问特定的外设。



哈佛结构：程序和数据分开放，程序放在ROM中，数据放在RAM中。（单片机都是这样的）

冯诺依曼结构：数据和程序都放在内存中。



# 10、寄存器

寄存器有两种，一种是特殊功能寄存器，一种是通用寄存器



# 11、内存与外存的各种物质

内存（RAM）：

SRAM:上电即可运行，不需要初始化。

SDRAM：同步动态随机存储器。需要初始化才可以使用

DDR：双向倍速SDRAM。需要初始化才能使用。有DDR1、DDR2、DDR3、DDR4。



外存：

Norflash:上电就可以使用，是总线式访问的，接到SROM bank上。

Nandflash:分为MLC和SLC。MLC常用便宜但是不稳定，SLC贵，但是稳定，需要初始化才能用

eMMC：分为iNand（SanDisk）和movinand(三星设计)，需要初始化才能用

onenand:三星设计的一种存储物质，贼贵，需要初始化才能用

SD/TF/MMC卡：存储卡

ESSD：固态硬盘

SATA：机械硬盘



# 12、s5pv210介绍

我用的是s5pv210的芯片，s5pv210有内置的64KB的IROM（类似于norflash,可以上电直接使用。）和96KB的IRAM（是SRAM可以上电直接使用的）。

其中的IROM是由内置代码的，固话在上面，由三星公司烧进去的，未公开的代码。IROM中有各种外存的设备初始化的代码，因为世界上应该也就只有这几种物质，但是没有DDR初始化的代码，因为生产DDR的生产商很多。

**s5pv210**的启动方式详解

①三星推荐的启动方式：

三星公司要求所使用的BootLoader必须大于16KB，又必须小于96KB，我们先假设我们的BootLoader为80KB，开机，首先BL0（也就是IROM上的代码）最开始运行，BL0会根据判断我们的启动方式，选择外部的存储介质。，加载BootLoader中的前16KB到SRAM中运行，这个前16KB的代码就是BL1。BL1运行会加载BL2（剩余的64KB的代码）到SARM中运行。BL2会将DDR初始化。并将内核加载到DDR中去运行，BootLoader结束。



②uboot的启动方式：

uboot可以任意大小，无所谓。首先BL0（也就是IROM上的代码）最开始运行，BL0会根据判断我们的启动方式，选择外部的存储介质。，加载BootLoader中的前8KB或者16KB到SRAM中运行，这个前16KB的代码就是BL1。这个BL1就会去初始化DDR。并且把整个uboot加载到DDR中去执行，BL2就会去启动内核。

实际在uboot中，会有一个脚本将uboot截成一个8KB或者16KB大小的文件，这就是BL1 ，放在SD卡中的第一个扇区。整个uboot作为BL2放在第49个扇区。（放在哪个扇区都是自己设计的，放在哪里就去哪里找），执行完BL1之后，BL1会重定位将BL2加载到DDR，然后长跳转执行后面的程序。



# 13、ARM的编程模式和7种工作模式

编程模式：

ARM模式：ARM指令集

thumb模式：thumb指令集

thumb2模式：thumb2指令集



工作模式：

user：非特权模式，大部分都在这种模式下工作



FIQ：快速中断模式					  异常模式，特权模式

IRQ：普通中断模式					  异常模式，特权模式

Supervisor：复位或者软中断模式		 异常模式，特权模式

Abort：存取异常					     异常模式，特权模式

undef:未定义模式					   异常模式，特权模式

 

system：系统模式					   特权模式



# 14、ARM的通用寄存器

user模式下可用的寄存器是r0~r15和cpsr寄存器，其中r13又叫sp（栈）寄存器，r14又叫lr寄存器。r15又叫pc寄存器。

pc（程序控制寄存器）中的地址是哪里，CPU就执行在哪里。

FIQ：其中的寄存器r0~r7和r15以及cpsr寄存器和user一样，但是有自己的r8~r14,以及spsr

IRQ：其中的寄存器r0~r12和r15以及cpsr寄存器和user一样，但是有自己的r13~r14,以及spsr

Supervisor：其中的寄存器r0~r12和r15以及cpsr寄存器和user一样，但是有自己的r13~r14,以及spsr

Abort：其中的寄存器r0~r12和r15以及cpsr寄存器和user一样，但是有自己的r13~r14,以及spsr

undef：其中的寄存器r0~r12和r15以及cpsr寄存器和user一样，但是有自己的r13~r14,以及spsr



system：和user的寄存器一模一样，但是这是特权模式下的。



这里所有的cpsr又叫程序状态寄存器，其中bit0~bit4位工作模位，bit5是ARM编程模式位，bit6和bit7是FIQ和IRQ的中断使能位，bit28~bit31是条件位。



# 15、ARM异常处理方式

异常向量表

![异常向量表](https://i.loli.net/2019/04/07/5ca9f4b573828.png)



发生异常时：

①拷贝cpsr到spsr中

②设置cpsr

③保存返回地址到lr

④设置pc到异常处

⑤返回：从spsr到cpsr，从lr到pc



